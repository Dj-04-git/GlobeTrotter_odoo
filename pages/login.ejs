<!DOCTYPE html>
<html lang="en" data-theme="light">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Welcome Back - Login</title>
  <link href="https://cdn.jsdelivr.net/npm/daisyui@4.12.10/dist/full.min.css" rel="stylesheet" type="text/css" />
  <script src="https://cdn.tailwindcss.com"></script>
  <!-- Alpine.js and Alpine Ajax -->
  <script defer src="https://cdn.jsdelivr.net/npm/@imacrayon/alpine-ajax@0.8.0/dist/alpine-ajax.min.js"></script>
  <script defer src="https://cdn.jsdelivr.net/npm/alpinejs@3.14.1/dist/cdn.min.js"></script>
  <script>
    tailwind.config = {
      theme: {
        extend: {
          colors: {
            gold: {
              400: '#d4a574',
              500: '#c4945a',
            }
          }
        }
      }
    }
  </script>
  <style>
      [x-cloak] { display: none !important; }
  </style>
</head>
<body class="min-h-screen flex flex-col bg-gradient-to-br from-[#f5f0e8] to-[#f0ebe0] font-sans">
  
    <!-- Navbar -->
    <div class="navbar bg-base-100/80 backdrop-blur-md shadow-sm sticky top-0 z-50">
        <div class="flex-1">
            <a href="/" class="btn btn-ghost text-xl font-bold text-gray-800">Global<span class="text-gold-500">Trotter</span></a>
        </div>
        <div class="flex-none">
            <ul class="menu menu-horizontal px-1 text-sm font-medium text-gray-600">
                <li><a href="/login" class="hover:text-gold-500">Login</a></li>
                <li><a href="/register" class="text-gold-500 active:bg-transparent hover:text-gold-600">Register</a></li>
            </ul>
        </div>
    </div>

    <main class="flex-grow flex items-center justify-center p-5">
        <div class="card w-full max-w-md bg-base-100 shadow-2xl" x-data="loginForm()">
            
            <div class="card-body p-10">
            <div class="text-center mb-8">
                <div class="w-20 h-20 rounded-full bg-gradient-to-br from-gold-400 to-gold-500 flex items-center justify-center mx-auto mb-5 text-4xl shadow-md">
                ☺️
                </div>
                <h1 class="text-3xl font-bold text-gray-800 mb-2">Welcome back</h1>
                <p class="text-sm text-gray-500">Sign in to your peaceful space</p>
            </div>

            <div class="alert alert-success text-sm py-3" x-show="successMessage" x-transition x-cloak>
                <span x-text="successMessage"></span>
            </div>

            <form @submit.prevent="submitForm" class="space-y-5">
                <div class="form-control w-full">
                <label class="label py-1">
                    <span class="label-text text-sm font-medium text-gray-600">Email address</span>
                </label>
                <input type="email" x-model="formData.email" placeholder="Enter your email" class="input input-bordered w-full h-11 text-sm focus:border-gold-400 focus:outline-none bg-gray-50 focus:bg-white transition-colors" :class="{'input-error': errors.email}" required />
                <label class="label py-0" x-show="errors.email" x-cloak>
                    <span class="label-text-alt text-error" x-text="errors.email"></span>
                </label>
                </div>

                <div class="form-control w-full">
                <label class="label py-1">
                    <span class="label-text text-sm font-medium text-gray-600">Password</span>
                </label>
                <input type="password" x-model="formData.password" placeholder="Enter your password" class="input input-bordered w-full h-11 text-sm focus:border-gold-400 focus:outline-none bg-gray-50 focus:bg-white transition-colors" :class="{'input-error': errors.password}" required />
                <label class="label py-0" x-show="errors.password" x-cloak>
                    <span class="label-text-alt text-error" x-text="errors.password"></span>
                </label>
                </div>

                <div class="flex justify-between items-center text-sm mt-2">
                <label class="cursor-pointer flex items-center gap-2 text-gray-600">
                    <input type="checkbox" x-model="formData.rememberMe" class="checkbox checkbox-sm checkbox-warning border-gray-300 checked:border-gold-400 [--chkbg:theme(colors.gold.400)] [--chkfg:white]" />
                    <span>Remember me</span>
                </label>
                <a href="/forgot-password" class="text-gold-400 font-medium hover:text-gold-500 transition-colors">Forgot password?</a>
                </div>

                <button type="submit" class="btn w-full bg-gradient-to-br from-gold-400 to-gold-500 border-none text-white hover:shadow-lg hover:-translate-y-0.5 transition-all mt-4 text-base" :disabled="isLoading">
                    <span x-show="isLoading" class="loading loading-spinner loading-sm"></span>
                    <span x-show="!isLoading">Sign in</span>
                </button>
            </form>

            <div class="text-center mt-8 text-sm text-gray-600">
                Don't have an account? <a href="/register" class="text-gold-400 font-semibold hover:text-gold-500 transition-colors">Sign up</a>
            </div>
            </div>
        </div>
    </main>

  <script>
    function loginForm() {
        return {
            formData: {
                email: '',
                password: '',
                rememberMe: false
            },
            errors: {},
            isLoading: false,
            successMessage: '',

            async submitForm() {
                this.errors = {};
                this.successMessage = '';
                this.isLoading = true;

                try {
                    const response = await fetch('/api/auth/login', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(this.formData),
                    });

                    const data = await response.json();

                    if (response.ok) {
                        this.successMessage = 'Login successful! Redirecting...';
                        localStorage.setItem('token', data.token);
                        localStorage.setItem('userId', data.userId);
                        setTimeout(() => {
                            window.location.href = '/dashboard';
                        }, 1500);
                    } else {
                        const errorMsg = data.error || data.message || 'Login failed';
                        if (errorMsg.toLowerCase().includes('email') || errorMsg.toLowerCase().includes('not found')) {
                            this.errors.email = errorMsg;
                        } else if (errorMsg.toLowerCase().includes('password')) {
                            this.errors.password = errorMsg;
                        } else {
                            this.errors.email = errorMsg;
                        }
                    }
                } catch (error) {
                    console.error('Error:', error);
                    this.errors.email = 'An error occurred. Please try again.';
                } finally {
                    this.isLoading = false;
                }
            }
        }
    }
  </script>
</body>
</html>